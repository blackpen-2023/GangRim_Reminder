<!DOCTYPE html>
<html lang="ko">
<head>
  <!-- 기존 head 내용 유지 -->
  <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
</head>
<body>
  <!-- 기존 body 내용 유지 -->

  <script>
    // Firebase 초기화 코드 유지

    // Kakao SDK 초기화
    Kakao.init('YOUR_JAVASCRIPT_KEY');

    // 카카오 채널 메시지 전송 함수
    async function sendKakaoChannelMessage(reservationData) {
      try {
        // 액세스 토큰 얻기 (실제 구현에서는 서버에서 안전하게 관리해야 함)
        const tokenResponse = await Kakao.Auth.getAccessToken();
        const accessToken = tokenResponse.access_token;

        // 채널 메시지 API 호출
        const response = await fetch('https://kapi.kakao.com/v1/api/talk/channels/message/send', {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${accessToken}`,
            'Content-Type': 'application/x-www-form-urlencoded'
          },
          body: new URLSearchParams({
            'channel_public_id': 'YOUR_CHANNEL_PUBLIC_ID',
            'template_object': JSON.stringify({
              object_type: 'text',
              text: `새로운 예약이 등록되었습니다!\n날짜: ${reservationData.date}\n시간: ${reservationData.time}\n인원: ${reservationData.count}명\n메모: ${reservationData.memo}\n전화번호: ${reservationData.phoneNum}`,
              link: {
                web_url: 'https://your-website.com',
                mobile_web_url: 'https://your-website.com'
              },
              button_title: '예약 확인하기'
            })
          })
        });

        if (!response.ok) {
          throw new Error('메시지 전송 실패');
        }

        console.log('메시지 전송 성공');
      } catch (error) {
        console.error('메시지 전송 오류:', error);
      }
    }

    // 예약 등록 이벤트 리스너 수정
    const reserveForm = document.getElementById("reserveForm");
    reserveForm.addEventListener("submit", async (event) => {
      event.preventDefault();

      // 기존 예약 데이터 수집 코드 유지

      try {
        await db.collection("reservations").add(reservationData);
        alert("예약이 등록되었습니다!");
        await sendKakaoChannelMessage(reservationData); // 카카오톡 채널 메시지 전송
        reserveForm.reset();
        renderGalleryDays();
      } catch (error) {
        console.error("Error adding reservation:", error);
        alert("예약 등록에 실패했습니다.");
      }
    });

    // 나머지 기존 코드 유지
  </script>
</body>
</html>
